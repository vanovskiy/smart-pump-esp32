#ifndef CONFIG_H  // Если макрос CONFIG_H еще не определен (защита от повторного включения)
#define CONFIG_H  // Определяем макрос CONFIG_H, чтобы при следующем включении файла пропустить его содержимое

#include <Arduino.h>  // Подключаем основную библиотеку Arduino для использования типов и констант

// ==================== ПИНЫ ПОДКЛЮЧЕНИЯ ====================
// Номера пинов ESP32 для подключения периферии
// ВНИМАНИЕ: Менять только при изменении физического подключения устройств!

/** Пин для управления реле помпы (подача воды) */
#define PIN_PUMP_RELAY 26

/** Пин для управления реле питания чайника (включение/выключение) */
#define PIN_POWER_RELAY 25

/** Пин данных (DT) тензодатчика HX711 */
#define PIN_HX711_DT 16

/** Пин тактового сигнала (SCK) тензодатчика HX711 */
#define PIN_HX711_SCK 4

/** Пин тактовой кнопки (подключена к GND, INPUT_PULLUP) */
#define PIN_BUTTON 27

/** Пин данных I2C (SDA) для OLED дисплея SSD1306 */
#define PIN_DISPLAY_SDA 21

/** Пин тактового сигнала I2C (SCL) для OLED дисплея SSD1306 */
#define PIN_DISPLAY_SCL 22

/** Пин управления сервоприводом (PWM) */
#define PIN_SERVO 32

/** Пин управления пассивным зуммером (PWM) */
#define PIN_BUZZER 33

// ==================== ПАРАМЕТРЫ СИСТЕМЫ ====================
// Основные физические параметры работы помпы

/** Объем одной кружки в миллилитрах (граммах) */
#define CUP_VOLUME 250.0f

/** Гистерезис для стабильности измерений веса (граммы) */
#define WEIGHT_HYST 20.0f

/** Минимальный уровень воды для включения чайника (мл/г) */
#define MIN_WATER_LEVEL 500.0f

/** Максимальный уровень воды (полный чайник) в мл/г */
#define FULL_WATER_LEVEL 1700.0f

/** Смещение веса пустого чайника (не используется, зарезервировано) */
#define EMPTY_KETTLE_OFFSET 0.0f

// ==================== ВРЕМЕННЫЕ КОНСТАНТЫ ====================
// Все значения в миллисекундах

/** Время антидребезга кнопки (мс) */
#define DEBOUNCE_TIME 50

/** Минимальная длительность для определения длительного нажатия (3 секунды) */
#define LONG_PRESS_TIME 3000

/** Минимальная длительность для определения очень длительного нажатия (10 секунд) */
#define VERY_LONG_PRESS_TIME 10000

/** Интервал для определения двойного/тройного клика (мс) */
#define DOUBLE_CLICK_TIME 400

/** Максимальное время работы помпы (2 минуты) - защита от бесконечной работы */
#define PUMP_TIMEOUT 120000

/** Время ожидания изменения веса перед определением ошибки "нет потока" (5 секунд) */
#define NO_FLOW_TIMEOUT 5000

/** Минимальный интервал между переключениями реле питания (2 секунды) */
#define POWER_RELAY_COOLDOWN 2000

/** Время, за которое сервопривод перемещается из одной позиции в другую (1 секунда) */
#define SERVO_MOVE_TIME 1000

/** Базовая длительность звукового сигнала зуммера (100 мс) */
#define BUZZER_FEEDBACK 100

/** Задержка в главном цикле loop() для снижения нагрузки на процессор */
#define LOOP_DELAY 100

// ==================== ПАМЯТЬ ====================
// Настройки для работы с EEPROM (энергонезависимая память)

/** Размер EEPROM в байтах (512 байт для ESP32) */
#define EEPROM_SIZE 512

/** Адрес в EEPROM для хранения калибровочных данных весов */
#define EEPROM_CALIB_ADDR 0

// ==================== СБРОС ====================
// Пороги времени для сброса настроек

/** Время удержания для сброса калибровки (10 секунд) */
#define RESET_CALIB_TIME 10000

/** Время удержания для полного сброса (WiFi + калибровка) - 15 секунд */
#define RESET_FULL_TIME 15000

// ==================== MQTT НАСТРОЙКИ ====================
// Параметры для работы с MQTT брокером Dealgate

/** Интервал между попытками переподключения к MQTT (5 секунд) */
#define MQTT_RECONNECT_INTERVAL 5000

/** Интервал проверки необходимости публикации в MQTT (2 секунды) */
#define MQTT_PUBLISH_INTERVAL 2000

// ==================== СОСТОЯНИЯ СИСТЕМЫ ====================
// Перечисления для конечного автомата

/**
 * Основные состояния системы
 * Используется в StateMachine и Display
 */
enum SystemState {
    ST_INIT,        // Состояние инициализации при запуске
    ST_IDLE,        // Режим ожидания (основное состояние)
    ST_FILLING,     // Процесс налива воды
    ST_CALIBRATION, // Режим калибровки весов
    ST_ERROR        // Режим ошибки
};

/**
 * Шаги процесса калибровки
 * Используется в CalibrationState
 */
enum CalibrationStep {
    CALIB_WAIT_REMOVE,  // Шаг 1: ожидание, пока пользователь уберет чайник
    CALIB_WAIT_PLACE    // Шаг 2: ожидание, пока пользователь поставит пустой чайник
};

/**
 * Типы ошибок системы
 * Используется в ErrorState и Display
 */
enum ErrorType {
    ERR_NONE,            // Нет ошибки
    ERR_HX711_TIMEOUT,   // Ошибка связи с тензодатчиком HX711
    ERR_NO_FLOW,         // Отсутствие потока воды при работающей помпе
    ERR_FILL_TIMEOUT     // Превышение времени налива (2 минуты)
};

/**
 * Состояния сервопривода
 * Используется в PumpController
 */
enum ServoState {
    SERVO_IDLE,         // Серво в безопасной позиции (угол 0°)
    SERVO_MOVING,       // Серво в процессе движения
    SERVO_OVER_KETTLE   // Серво в позиции над чайником (угол 90°)
};

#endif // Завершение условия #ifndef CONFIG_H - конец файла